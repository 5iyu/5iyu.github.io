---
title: 快速实例化服务器
date: 2024-06-13 00:33:09
categories: 环境部署
tags:
  - ubuntu
  - docker
  - aliyun
---

## 解决新服务器无法使用root远程登录
1 使用内网进入服务器，切换到root用户
```
sudo su - root
```
<!-- more -->
修改SSH配置文件
```
sudo vim /etc/ssh/sshd_config
```
将行末的PasswordAuthentication no修改为PasswordAuthentication yes。

## root创建用户alex
adduser alex
## 授予sudo权限
分配到 `sudo`组 
```
sudo adduser image sudo
```
重启生效

## 安装dockre
切换apt源
```
sudo apt-get install ca-certificates curl

curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -

sudo add-apt-repository "deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"

sudo apt-get install docker-ce docker-ce-cli containerd.io
```
### 解决add-apt-repository: command not found
add-apt-repository 命令是software-properties-common包的一部分，因此安装这个包就OK了
```
sudo apt-get install software-properties-common
sudo apt-get update
```

## 修改用户密码，注意安全
root可以在网站修改

```
sudo passwd username
```

## Ubuntu非root用户添加docker用户组
安装完docker以后，普通用户使用dockre指令需要sudo提权，这是用为docker需要使用到系统比较底层的资源。因此docker服务本身也是使用root用户运行的。
1 验证是否有docker用户组
```
gre docker /etc/group
```

如下所示：
```
alex@iZwz94u15dhankf4ub3nn4Z:~$ grep docker /etc/group
docker:x:998:alex
```
1.1 如果没用dokcer用户组则创建
```
sudo groupadd docker
```
2 添加非root用户到docker用户组
```
sudo uaermod -aG docker alex
```
## 安装小雅alist
1 镜像起别名
```
docker tag registry.cn-hangzhou.aliyuncs.com/jack-images/alist-aria2:latest aria2:latest
```

一键启动
```
docker run -d --restart=unless-stopped -v /etc/alist:/opt/alist/data -p 5244:5244 -e PUID=0 -e PGID=0 -e UMASK=022 --name="alist" xhofe/alist:latest

```

防火墙开放5244端口

[http://47.xxx.xxx.10:5244/](http://47.xxx.xxx.10:5244/)
生成admin随机密码
C4RSkVGi

## 挂载阿里云
1 生成刷新令牌
2 选择挂载目录ID

## 绑定域名
域名是国外的，服务器是国内的，好奇的是这个是服务器运营商搞的吗。
![20240613003519](https://s2.loli.net/2024/06/13/hjVloJ7e2cPNZvF.png)
拦截原因
过第一遍http的时候  80port 通信内容Headers信息里的Host：域名 已被记录

再次访问没有备案直接带这个host返回警告。